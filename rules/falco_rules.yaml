# This rule checks for the execution of a process named "chrome" and checks if the file descriptor (fd) name contains the string "log". 
# If both conditions are met, it triggers the output message "Drive-by compromise detected: process (pid=%proc.pid) - %proc.cmdline" 

- rule: Detect Drive-by Compromise
  desc: Detects when a process writes to an application log file, indicating a possible drive-by compromise.
  condition: evt.type = execve and proc.name = chrome and fd.name contains "log"
  output: "Drive-by compromise detected: process (pid=%proc.pid) - %proc.cmdline"
  priority: WARNING
  tags: [mitre_initial_access, DS0015]

# This rule will triggers when a file is opened and the file name contains "http" and the directory is "/tmp/" and the file name ends with ".exe". 
# The above conditions ensure we are accurately indicating that is file is likely downloaded from a website and potentially malicious.

- rule: Detect Drive-by File Creation
  desc: Detects when a new file is created on the system as a result of a drive-by compromise
  condition: evt.type=open and fd.name contains "http" and fd.directory contains "/tmp/" and fd.name ends_with ".exe"
  output: "Drive-by file creation detected: file=%fd.name directory=%fd.directory"
  priority: WARNING  

# This rule triggers when a new network connection is created and the file name contains "http" and the directory is "/tmp/" 
# Or event direction is incoming and the socket family is AF_INET. Indicates it's likely initiated by downloaded file from website & potentially malicious.

- rule: Detect Network Connection Creation from Drive-by
  desc: Detects when a new network connection is created as a result of a drive-by compromise
  condition: (evt.type=connect and fd.name contains "http" and fd.directory contains "/tmp/") or (evt.type=connect and evt.dir=< and fd.sockfamily=AF_INET)
  output: "Drive-by network connection detected: process=%proc.name connection=%fd.name"
  priority: WARNING
